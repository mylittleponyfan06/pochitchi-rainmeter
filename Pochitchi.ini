[Rainmeter]
Update=1000
AccurateText=1
DynamicWindowSize=1
BackgroundMode=2
SolidColor=0,0,0,0
OnRefreshAction=[!Redraw]

; Include variables (moved to after [Variables] so user overrides win)

[Variables]
; Fallback defaults (used if Variables.inc is missing)
SkinName="Pochitchi - 3060ti"
BGColor=255,245,250,200
TitleColor=150,40,150,255
TextColor=80,40,80,255
AccentColor=255,150,200,255
BarBg=240,220,240,120
BorderColor=230,180,210,150
AppleIcon=#@#icons\apple.png
AppleSize=23
ImageOverride=0
ShakeOffset=6
ShakeRepeats=8


; HWiNFO registry index mappings
GPUTempIndex=4
GPUUsageIndex=7

; Temperature image switching
TempAssetsPath=#@#
; Thresholds (°C)
NeutralMin=40
WarmMin=65
HotMin=80
; Image filenames
ImgCool=coldtemp.webp
ImgNeutral=neutraltemp.webp
ImgWarm=abitwarm.webp
ImgHot=TOOHOT.webp
; Resolved at runtime
TempImage=
; Image size/position
; Canvas size
SkinW=360
SkinH=232
TempImgSize=96
TempImgY=24
; GPU usage graph sizing
GPUGraphW=220
GPUGraphH=36
GPUGraphX=15
GPUGraphY=53

; GPU usage auto color thresholds and colors
UsageWarn=70
UsageHigh=90
; Base colors
UsageColorNorm=#AccentColor#
UsageColorWarn=255,210,0,255
UsageColorHigh=255,80,80,255
; Active colors (set at runtime)
GPUUseColor=#AccentColor#
GPUUseLineColor=180,60,120,255

; Disk usage color thresholds and active color
DiskWarn=70
DiskHigh=85
DiskUseColor=#AccentColor#

; (Removed) Network measures

; --------------------
; User overrides (optional). Define [Variables] in Variables.inc to override any defaults above.
@include=Variables.inc
; --------------------
; After this point measures/meters will pick up any overridden variables.
; --------------------
; GPU MEASURES (HWiNFO)
; --------------------
[MeasureGPUUsage]
Measure=Registry
RegHKey=HKEY_CURRENT_USER
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#GPUUsageIndex#
UpdateDivider=1
MinValue=0
MaxValue=100
Percentual=1

; Switch GPU usage colors based on thresholds
[MeasureGPUUsageColor]
Measure=Calc
Formula=MeasureGPUUsage
DynamicVariables=1
IfCondition=(MeasureGPUUsage>=#UsageHigh#)
IfTrueAction=[!SetVariable GPUUseColor "#UsageColorHigh#"][!SetVariable GPUUseLineColor "200,40,40,255"]
IfCondition2=(MeasureGPUUsage>=#UsageWarn#) && (MeasureGPUUsage<#UsageHigh#)
IfTrueAction2=[!SetVariable GPUUseColor "#UsageColorWarn#"][!SetVariable GPUUseLineColor "200,160,0,255"]
IfCondition3=(MeasureGPUUsage<#UsageWarn#)
IfTrueAction3=[!SetVariable GPUUseColor "#UsageColorNorm#"][!SetVariable GPUUseLineColor "180,60,120,255"]

[MeasureGPUTemp]
Measure=Registry
RegHKey=HKEY_CURRENT_USER
RegKey=SOFTWARE\HWiNFO64\VSB
RegValue=ValueRaw#GPUTempIndex#
UpdateDivider=1

; (Removed) GPU memory usage measure

; --------------------
; SYSTEM MEASURES (RAM & DISK)
; --------------------
[MeasureRAM]
Measure=PhysicalMemory
UpdateDivider=1

[MeasureRAMTotal]
Measure=PhysicalMemory
Total=1
UpdateDivider=120

[MeasureRAMPercent]
Measure=Calc
Formula=(MeasureRAM/MeasureRAMTotal)*100
DynamicVariables=1

[MeasureDiskTotalC]
Measure=FreeDiskSpace
Drive=C:
Total=1
UpdateDivider=120

[MeasureDiskUsedC]
Measure=FreeDiskSpace
Drive=C:
InvertMeasure=1
UpdateDivider=120

; Derived disk measures (percent and GB figures)
[MeasureDiskUsedPercent]
Measure=Calc
Formula=(MeasureDiskUsedC/MeasureDiskTotalC)*100
DynamicVariables=1

[MeasureDiskUsedPercentInt]
Measure=Calc
Formula=Round((MeasureDiskUsedC/MeasureDiskTotalC)*100)
DynamicVariables=1

[MeasureDiskUsedGB]
Measure=Calc
Formula=MeasureDiskUsedC/1073741824
DynamicVariables=1

[MeasureDiskTotalGB]
Measure=Calc
Formula=MeasureDiskTotalC/1073741824
DynamicVariables=1

; Rounded GB values for display (1 decimal)
[MeasureDiskUsedGB1]
Measure=Calc
Formula=Round(MeasureDiskUsedGB,1)
DynamicVariables=1

[MeasureDiskTotalGB1]
Measure=Calc
Formula=Round(MeasureDiskTotalGB,1)
DynamicVariables=1

; Switch Disk C bar color based on thresholds
[MeasureDiskColor]
Measure=Calc
Formula=MeasureDiskUsedPercent
DynamicVariables=1
IfCondition=(MeasureDiskUsedPercent>=#DiskHigh#)
IfTrueAction=[!SetVariable DiskUseColor "#UsageColorHigh#"]
IfCondition2=(MeasureDiskUsedPercent>=#DiskWarn#) && (MeasureDiskUsedPercent<#DiskHigh#)
IfTrueAction2=[!SetVariable DiskUseColor "#UsageColorWarn#"]
IfCondition3=(MeasureDiskUsedPercent<#DiskWarn#)
IfTrueAction3=[!SetVariable DiskUseColor "#UsageColorNorm#"]

; --------------------
; METERS
; --------------------
[MeterBG]
Meter=Shape
Shape=Rectangle 0,0,#SkinW#,([MeterDiskBar:Y]+[MeterDiskBar:H]+12),5 | Fill Color #BGColor#
W=#SkinW#
H=([MeterDiskBar:Y]+[MeterDiskBar:H]+12)
DynamicVariables=1
LeftMouseUpAction=[!CommandMeasure MeasureClickShake "Execute 1"]

[MeterTitle]
Meter=String
Text=#SkinName#
FontColor=#TitleColor#
FontSize=14
X=12
Y=8

; Temperature state image (changes with GPU temp)
[MeterTempImage]
Meter=Image
ImageName=#TempImage#
DynamicVariables=1
W=#TempImgSize#
H=#TempImgSize#
PreserveAspectRatio=1
X=(#SkinW#-#TempImgSize#-12)
Y=#TempImgY#
LeftMouseUpAction=[!CommandMeasure MeasureClickShake "Execute 1"]


[MeterGPUUsageLabel]
Meter=String
Text="GPU Usage"
FontColor=#TextColor#
FontSize=10
StringStyle=Bold
X=12
Y=36

[MeterGPUUsageFill]
Meter=Bar
MeasureName=MeasureGPUUsage
BarColor=#GPUUseColor#
BarBgColor=#BarBg#
W=#GPUGraphW#
H=#GPUGraphH#
X=#GPUGraphX#
Y=#GPUGraphY#
DynamicVariables=1

[MeterGPUUsageLine]
Meter=Line
MeasureName=MeasureGPUUsage
LineWidth=2
LineColor=#GPUUseLineColor#
SolidColor=0,0,0,0
AntiAlias=1
AutoScale=0
MinValue=0
MaxValue=100
W=(#GPUGraphW#-2)
H=(#GPUGraphH#-2)
X=(#GPUGraphX#+1)
Y=(#GPUGraphY#+1)
DynamicVariables=1

[MeterGPUUsagePercent]
Meter=String
MeasureName=MeasureGPUUsage
Text="%1%"
NumOfDecimals=0
FontColor=#GPUUseLineColor#
FontSize=12
StringAlign=Right
X=(#GPUGraphX#+#GPUGraphW#-6)
Y=36
DynamicVariables=1

[MeterGPUTempLabel]
Meter=String
Text="GPU Temp:"
FontColor=#TextColor#
FontSize=10
StringStyle=Bold
X=12
Y=(#GPUGraphY#+#GPUGraphH#+8)

[MeterGPUTemp]
Meter=String
MeasureName=MeasureGPUTemp
Text=" %1°C"
FontColor=#GPUUseLineColor#
FontSize=10
X=([MeterGPUTempLabel:X]+[MeterGPUTempLabel:W]+4)
Y=0r
DynamicVariables=1


[MeterGPUUsageBorder]
Meter=Shape
Shape=Rectangle #GPUGraphX#,#GPUGraphY#,#GPUGraphW#,#GPUGraphH# | StrokeWidth 1 | Stroke Color #BorderColor# | Fill Color 0,0,0,0
; --------------------
; RAM & DISK METERS
; --------------------
[MeterRAMLabel]
Meter=String
Text="RAM Usage"
FontColor=#TextColor#
FontSize=10
StringStyle=Bold
X=12
Y=(#GPUGraphY#+#GPUGraphH#+28)
DynamicVariables=1

[MeterRAMPercent]
Meter=String
MeasureName=MeasureRAMPercent
Text="%1%"
NumOfDecimals=0
FontColor=#GPUUseLineColor#
FontSize=10
StringAlign=Right
X=(#GPUGraphX#+#GPUGraphW#)
Y=0r
DynamicVariables=1

[MeterRAMBar]
Meter=Shape
; Background
Shape=Rectangle 0,0,#GPUGraphW#,10 | Fill Color #BarBg#
; Fill proportional to percent
Shape2=Rectangle 0,0,((#GPUGraphW#*[MeasureRAMPercent])/100),10 | Fill Color #AccentColor#
W=#GPUGraphW#
H=10
X=#GPUGraphX#
Y=15r
DynamicVariables=1

[MeterDiskLabel]
Meter=String
Text="Disk C:"
FontColor=#TextColor#
FontSize=10
StringStyle=Bold
X=12
Y=8R
DynamicVariables=1

[MeterDiskPercent]
Meter=String
MeasureName=MeasureDiskUsedPercentInt
Text="%1%"
NumOfDecimals=0
FontColor=#GPUUseLineColor#
FontSize=10
StringAlign=Right
X=(#GPUGraphX#+#GPUGraphW#)
Y=0r
DynamicVariables=1

[MeterDiskGBInline]
Meter=String
MeasureName=MeasureDiskUsedGB1
MeasureName2=MeasureDiskTotalGB1
Text="%1 / %2 GB"
NumOfDecimals=0
FontColor=#TitleColor#
FontSize=10
StringAlign=Right
StringStyle=Bold
X=(#GPUGraphX#+#GPUGraphW#-[MeterDiskPercent:W]-6)
Y=0r
DynamicVariables=1

[MeterDiskBar]
Meter=Shape
; Background
Shape=Rectangle 0,0,#GPUGraphW#,10 | Fill Color #BarBg#
; Fill proportional to percent
Shape2=Rectangle 0,0,((#GPUGraphW#*[MeasureDiskUsedPercent])/100),10 | Fill Color #DiskUseColor#
W=#GPUGraphW#
H=10
X=#GPUGraphX#
Y=15r
DynamicVariables=1

[MeterRAMBorder]
Meter=Shape
Shape=Rectangle [MeterRAMBar:X],[MeterRAMBar:Y],[MeterRAMBar:W],[MeterRAMBar:H] | StrokeWidth 1 | Stroke Color #BorderColor# | Fill Color 0,0,0,0
DynamicVariables=1

[MeterDiskBorder]
Meter=Shape
Shape=Rectangle [MeterDiskBar:X],[MeterDiskBar:Y],[MeterDiskBar:W],[MeterDiskBar:H] | StrokeWidth 1 | Stroke Color #BorderColor# | Fill Color 0,0,0,0
DynamicVariables=1

; RAM usage marker (apple image + shape fallback)
[MeterRAMMarkerImg]
Meter=Image
ImageName=#AppleIcon#
W=#AppleSize#
H=#AppleSize#
PreserveAspectRatio=1
X=([MeterRAMBar:X]+(([MeterRAMBar:W]-#AppleSize#)*[MeasureRAMPercent]/100))
Y=([MeterRAMBar:Y]+(([MeterRAMBar:H]-#AppleSize#)/2))
DynamicVariables=1
Hidden=0

; Disk usage marker (apple image + shape fallback)
[MeterDiskMarkerImg]
Meter=Image
ImageName=#AppleIcon#
W=#AppleSize#
H=#AppleSize#
PreserveAspectRatio=1
X=([MeterDiskBar:X]+(([MeterDiskBar:W]-#AppleSize#)*[MeasureDiskUsedPercent]/100))
Y=([MeterDiskBar:Y]+(([MeterDiskBar:H]-#AppleSize#)/2))
DynamicVariables=1
Hidden=0


[MeasureTempSwitch]
Measure=Calc
Formula=MeasureGPUTemp
DynamicVariables=1
IfCondition=(#ImageOverride#=0) && (MeasureGPUTemp>=#HotMin#)
IfTrueAction=[!SetVariable TempImage "#TempAssetsPath##ImgHot#"]
IfCondition2=(#ImageOverride#=0) && (MeasureGPUTemp>=#WarmMin#) && (MeasureGPUTemp<#HotMin#)
IfTrueAction2=[!SetVariable TempImage "#TempAssetsPath##ImgWarm#"]
IfCondition3=(#ImageOverride#=0) && (MeasureGPUTemp>=#NeutralMin#) && (MeasureGPUTemp<#WarmMin#)
IfTrueAction3=[!SetVariable TempImage "#TempAssetsPath##ImgNeutral#"]
IfCondition4=(#ImageOverride#=0) && (MeasureGPUTemp<#NeutralMin#)
IfTrueAction4=[!SetVariable TempImage "#TempAssetsPath##ImgCool#"]

[MeasureClickShake]
Measure=Plugin
Plugin=ActionTimer
DynamicVariables=1
ActionList1=ShockStart | Wait 60 | Repeat ShakeStep, 70, #ShakeRepeats# | Wait 3500 | ShockEnd
ShockStart=[!SetVariable ImageOverride 1][!SetVariable TempImage "#TempAssetsPath#shocked.webp"][!UpdateMeter MeterTempImage][!Redraw]
ShakeStep=[!SetOption MeterTempImage X "(#SkinW#-#TempImgSize#-12-#ShakeOffset#)"][!UpdateMeter MeterTempImage][!Redraw][!SetOption MeterTempImage X "(#SkinW#-#TempImgSize#-12+#ShakeOffset#)"][!UpdateMeter MeterTempImage][!Redraw]
ShockEnd=[!SetOption MeterTempImage X "(#SkinW#-#TempImgSize#-12)"][!SetVariable ImageOverride 0][!UpdateMeasure MeasureTempSwitch][!UpdateMeter MeterTempImage][!Redraw]





